# 組合/對象樹 Object Tree/Composite
可以使用它將對象組合成樹狀結構， 並且能像使用獨立對像一樣使用它們

## 優缺點
### 優點
1. 可以利用多態和遞歸機制更方便地使用複雜樹結構

2. Open/Closed Principle

     無需更改現有代碼，你就可以在應用中添加新元素，使其成為對象樹的一部分
    


### 缺點
* 對於功能差異較大的類， 提供公共接口或許會有困難
* 在特定情況下， 你需要過度一般化組件接口， 使其變得令人難以理解

## Architecture

![](https://refactoringguru.cn/images/patterns/diagrams/composite/structure-zh.png)

1. 組件(Component)

    * 接口描述了樹中簡單項目和復雜項目所共有的操作

2. 葉節點(Leaf)
    
    * 樹的基本結構，它不包含子項目
    * 一般情況下，葉節點最終會完成大部分的實際工作，因為它們無法將工作指派給其他部分

3. 容器(Container) 又名 組合(Composite)
    
    * 是包含葉節點或其他容器等子項目的單位
    * 不知道其子項目所屬的具體類， 它只通過通用的組件接口與其子項目交互
    * 接收到請求後會將工作分配給自己的子項目，處理中間結果，然後將最終結果返回給客戶端
    
4. 客戶端(Client)

    * 通過組件接口與所有項目交互
    * 能以相同方式與樹狀結構中的簡單或複雜項目交互

## 應用場景
* 如果你想要拆分或重組一個具有多重功能的龐雜類
* 如果你希望在幾個獨立維度上擴展一個類
* 如果你需要在運行時切換不同實現方法

## 實現方式
下列五個步驟
1. 確保應用的核心模型能夠以樹狀結構表示

    * 嘗試將其分解為簡單元素和容器
    * 記住， 容器必須能夠同時包含簡單元素和其他容器
    
2. 聲明組件接口及其一系列方法， 這些方法對簡單和復雜元素都有意義
    
3. 創建一個葉節點類表示簡單元素
    
    * 程序中可以有多個不同的葉節點類
    
4. 創建一個容器類表示複雜元素

    * 在該類中， 創建一個數組成員變量來存儲對於其子元素的引用
    * 該數組必須能夠同時保存葉節點和容器， 因此請確保將其聲明為組合接口類型
    * 實現組件接口方法時， 記住容器應該將大部分工作交給其子元素來完成
    
5. 在容器中定義添加和刪除子元素的方法

    * 記住， 這些操作可在組件接口中聲明
    * 將會違反 接口隔離原則(Interface Segregation Principle, ISP) ， 因為葉節點類中的這些方法為空
    * 可以讓客戶端無差別地訪問所有元素， 即使是組成樹狀結構的元素