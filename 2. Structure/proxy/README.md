# 代理 Proxy
* 讓你能夠提供對象的替代品或其占位符
* 控制著對於原對象的訪問， 並允許在將請求提交給對象前後進行一些處理

## 優缺點
### 優點
1. 可以在客戶端毫無察覺的情況下控制服務對象

2. 如果客戶端對服務對象的生命週期沒有特殊要求，你可以對生命週期進行管理

3. 即使服務對像還未準備好或不存在，代理也可以正常工作

4. Open/Closed Principle

    可以在不對服務或客戶端做出修改的情況下創建新代理
    


### 缺點
* 代碼可能會變得複雜，因為需要新建許多類
* 服務響應可能會延遲

## Architecture

![](https://refactoringguru.cn/images/patterns/diagrams/proxy/structure.png)

1. 服務街口(Service Interface)

    * 聲明了服務接口
    * 代理必須遵循該接口才能偽裝成服務對象

2. 服務(Service)
    
    * 提供了一些實用的業務邏輯


3. 代理(Proxy)
    
    * 包括特定於平台的代碼
    
4. 客戶端(Client)

    * 僅關心如何與抽象部分合作
    * 需要將抽像對象與一個實現對象連接起來

## 應用場景
* 延遲初始化(虛擬代理)

    如果你有一個偶爾使用的重量級服務對象，一直保持該對象運行會消耗系統資源時

* 訪問控制(保護代理)

    如果你只希望特定客戶端使用服務對象，這裡的對象可以是操作系統中非常重要的部分，而客戶端則是各種已啟動的程序(包括惡意程序)

* 本地執行遠程服務(遠程代理)

    適用於服務對象位於遠程服務器上的情形
    
* 記錄日誌請求(日誌記錄代理)

    適用於當你需要保存對於服務對象的請求歷史記錄時
    
* 智能引用

    可在沒有客戶端使用某個重量級對象時立即銷毀該對象  

## 實現方式
下列五個步驟
1. 如果沒有現成的服務接口，你就需要創建一個接口來實現代理和服務對象的可交換性

    * 從服務類中抽取接口並非總是可行的，因為你需要對服務的所有客戶端進行修改，讓它們使用接口
    * 備選計劃是將代理作為服務類的子類，這樣代理就能繼承服務的所有接口了
    
2. 創建代理類， 其中必須包含一個存儲指向服務的引用的成員變量

    * 通常情況下， 代理負責創建服務並對其整個生命週期進行管理
    * 在一些特殊情況下， 客戶端會通過構造函數將服務傳遞給代理
    
3. 根據需求實現代理方法
    
    * 在大部分情況下，代理在完成一些任務後應將工作委派給服務對象
    
4. 可以考慮新建一個構建方法來判斷客戶端可獲取的是代理還是實際服務

    * 可以在代理類中創建一個
        * 簡單的靜態方法
        * 完整的工廠方法
    
5. 可以考慮為服務對象實現延遲初始化
